# 输入相关

`peekmessage` 是 EasyX 中用于处理消息的函数之一，其底层原理与 Windows 消息机制密切相关。

___

`peekmessage` 底层调用了 Windows API 的 `PeekMessage`，非阻塞检查消息队列，并将复杂消息转换为 EasyX 的简化格式（如鼠标、键盘事件），适合实时处理输入而不卡住程序。

```c++
用户输入事件（如按键/鼠标）-> Windows系统接收 -> 放入系统消息队列 -> 
EasyX消息循环检查 -> peekmessage调用 -> 
{
    队列有消息? -> 是 -> 取出最早消息 -> 填充MSG结构 -> 返回非零
    队列无消息? -> 否 -> 立即返回0
} -> 
程序根据返回值处理（有消息则响应，无消息则继续其他逻辑）
```

视频讲解：https://www.bilibili.com/video/BV1iQ4y1s7Qj/?spm_id_from=333.1387.upload.video_card.click&vd_source=832de57dfbec1edb1b5684a47762a9de（第7分钟）

```c++
ExMessage msg;
while (peekmessage(&msg))  // 消息处理循环
{
    // 这里应该处理具体消息（如鼠标/键盘事件）
}
```



# 坐标系

```c++
(0,0) ——→ +X
  |
  ↓
 +Y
```

默认位于窗口**左上角** (0,0)



# 图片在内存中的存储形式

EasyX 的图像（通过 `IMAGE` 对象管理）在内存中以 **DIB 格式** 存储，包含：

- **位图信息头（BITMAPINFOHEADER）**：存储图像的宽、高、颜色深度（通常是 32 位 ARGB）、压缩方式等。
- **像素数据阵列**：连续存储每个像素的色值，排列顺序为 **自下而上**（即图像的第一行在内存中对应最后一行像素）。

```c++
用户创建 IMAGE 对象 -> 分配内存空间 -> 存储 DIB 格式数据 ->  
{
    位图信息头（BITMAPINFOHEADER）? -> 是 -> 记录宽、高、颜色深度 ->  
    像素数据? -> 是 -> 按 BGRA 顺序排列，自下而上存储  
} ->  
程序通过 GetImageBuffer() 访问 ->  
{
    返回有效指针? -> 是 -> 直接读写像素数据  
    返回空指针? -> 否 -> 图像未初始化或已销毁  
} ->  
开发者操作像素（如修改颜色、实现特效） 
```

1. **BGRA 顺序**：每个像素 4 字节，按 **Blue, Green, Red, Alpha** 存储。

```c++
IMAGE img;
loadimage(&img, _T("test.jpg"));
putimage(100, 200, &img)“不会使用透明度信息”
```

**特效**

```markdown
开发者操作像素（如修改颜色、实现特效） ->
{
    特效类型? -> 
    {
        模糊效果? -> 遍历像素 -> 计算周围像素平均值 -> 修改当前像素值
        灰度化?  -> 计算 RGB 平均值 -> 设置 R=G=B
        透明度混合? -> 使用 Alpha 通道混合两幅图像
        边缘检测?  -> 应用 Sobel/Kernel 卷积核 -> 计算梯度
        动态波纹?  -> 根据时间变量修改像素坐标 -> 模拟水波扩散
    }
} ->  
渲染到屏幕 -> 循环更新实现动画效果
```

